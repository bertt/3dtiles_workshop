<!doctype html>
<html lang="nl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Geef je data diepte: van 2D naar 3D met OS tools</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/theme/black.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/plugin/highlight/monokai.css">
    <!-- Custom style -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<style>

</style>

<body>
    <div class="reveal">
        <div class="slides">
            <!-- Titel slide -->
            <section class="center">
                <h3>Geef je data diepte:<br> van 2D naar 3D met OS tools</h3>
                <p>
                    &middot; Workshop 3D Tiles &middot; 
                </p>
            </section>

            <!-- Doelen en benodigdheden -->
            <section class="center">
                <div class="container">
                    <div class="col">
                        <h5>Na deze workshop</h5>
                        <ul>
                            <li>Heb je kennis van de 3D Tiles-standaard</li>
                            <li>Kun je 3D-tilesets maken uit 2D data</li>
                            <li>Kun je een 3D-tileset inladen in een CesiumJS-webomgeving</li>
                            <li>Zijn de mogelijkheden voor datavisualisatie met CesiumJS bekend</li>
                        </ul>
                    </div>
                    <div class="col">
                        <h5>Benodigdheden</h5>
                        <ul>
                            <li>Laptop met internetverbinding</li>
                            <li>Docker</li>
                            <li>QGIS 3.40 of hoger</li>
                            <li>DBeaver</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Programma slide -->
            <section class="center">
                <h3>Programma</h3>
                <ol>
                    <li>Introductie 3D Tiles</li>
                    <li>Deel 1: Dataverwerking tot 3D Tiles
                        <ul>
                            <li>Data downloaden en importeren</li>
                            <li>Data voorbereiden</li>
                            <li>3D Tiles maken</li>
                        </ul>
                    </li>
                    <li>Deel 2: Datavisualisatie in 3D
                        <ul>
                            <li>3D tilesets inladen</li>
                            <li>Tileset stijl aanpassen</li>
                            <li>3D modellen toevoegen</li>
                            <li>PDOK 3D Basisvoorziening</li>
                            <li>3D Tiles in QGIS inladen</li>
                        </ul>
                    </li>
                </ol>
            </section>

            <!-- 3D Tiles: een OGC standaard -->
            <section>
                <h3>3D Tiles: een OGC standaard</h3>
                <div class="container">
                    <div class="col">
                        <ul>
                            <li>Open standaard voor het visualiseren van (grote hoeveelheden) 3D geodata op het web</li>
                            <li>Ontwikkeld door Cesium en gestandaardiseerd door OGC</li>
                            <li>Hiërarchische datastructuur (spatial tiling)</li>
                            <li>Ondersteunt verschillende formaten:
                                <ul>
                                    <li>Batched 3D Models (b3dm)</li>
                                    <li>Instanced 3D Models (i3dm)</li>
                                    <li>Point Clouds (pnts)</li>
                                    <li>Composite (cmpt)</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="col">
                        <img src="images/3dtiles_ecosysteem.png" alt="3D Tiles Ecosysteem">
                    </div>
                </div>
                <p class="small-text">Zie voor een gedetailleerd overzicht van de 3D Tiles specificatie: <a
                        href="https://github.com/CesiumGS/3d-tiles/blob/main/3d-tiles-reference-card.pdf"
                        target="_blank">3D Tiles Reference Card</a></p>
            </section>

            <!-- Waarom zijn 3D Tiles nuttig? -->
            <section>
                <h3>Waarom zijn 3D Tiles nuttig?</h3>
                <ul>
                    <li>Optimalisatie voor grote datasets
                        <ul>
                            <li>Alleen de noodzakelijke data wordt ingeladen</li>
                            <li>Level of Detail (LOD) mechanisme</li>
                        </ul>
                    </li>
                    <li>Interoperabiliteit
                        <ul>
                            <li>Open standaard</li>
                            <li>Ondersteund door verschillende viewers (Cesium, ArcGIS, QGIS, Unity3D, Unreal)</li>
                        </ul>
                    </li>
                    <li>Streaming van 3D content
                        <ul>
                            <li>Progressief laden van data</li>
                            <li>Efficiënt voor web-based toepassingen</li>
                        </ul>
                    </li>
                    <li>Styling mogelijkheden
                        <ul>
                            <li>3D Tiles Styling Language</li>
                        </ul>
                    </li>
                </ul>
            </section>

            <!-- Introductie Digital Twins -->
            <section>
                <h3>Aan de slag!</h3>
                <div class="container">
                    <div class="col">
                        <ul>
                            <li>Casus: Proefpolderdijk bij Andijk</li>
                            <li>
                                Data:
                                <ul>
                                    <li>Digitaal Topografisch Bestand (DTB) voor het terrein en bomen</li>
                                    <li>De BAG voor gebouwen</li>
                                </ul>
                            </li>
                            <li>
                                Toevoegingen
                                <ul>
                                    <li>Windturbine 3D model (geanimeerd)</li>
                                    <li>Boom 3D model</li>
                                    <li>3D Basisvoorziening van PDOK</li>
                                    <li>IFC model van een gebouw</li>
                            </li>
                        </ul>
                    </div>
                    <div class="col">
                        <img src="images/windturbine.gif" alt="Het eindresultaat van de digital twin van Andijk">
                    </div>
                </div>
            </section>

            <section>
                <h3>Docker omgeving</h3>

                <p class="alert notice"><b>Let op:</b> Controleer dat Docker is geïnstalleerd en draait voordat je verder gaat.</p>

                <pre><code class="language-bash">docker ps</code></pre>
                <img src="images/docker_ps.png" alt="Docker ps Result">

                <p class="left m-0">Om de Docker omgeving op te starten zijn er twee bestanden nodig: <a href= "docker-compose.yml">docker-compose.yml</a> en 
                    <a href="Dockerfile">Dockerfile</a>. Deze bestanden staan in de repository van de workshop.</p>

                <p class="left m-0">Kopieer deze bestanden naar een lege directory op je lokale machine, bijvoorbeeld <code>c:\3dtiles-workshop</code>. Een makkelijke
                    manier om dit te doen is click rechtermuis op de link en kies 'Save link as...'</p>
                <p class="alert notice"><b>Tip:</b> Een alternatieve manier om de twee bestanden op te halen is de gehele repository te clonen via 'git clone'</p>

                <p class="left m-0">Open een terminal (cmd, PowerShell of Git Bash) en ga naar de directory waar je de bestanden hebt opgeslagen</p>


            </section>

            <!-- Workspace opzetten -->
            <section>
                <h3>Workspace opzetten met Docker</h3>
                <p class="left m-0">Voor het opzetten van de workspace run het volgende commando vanuit de
                    directory waar de bestanden <code>docker-compose.yml</code> en <code>Dockerfile</code> staan:</p>
                </p>
                <pre><code class="language-bash">docker compose up -d</code></pre>
                <img src="images/dockercomposeup.png" alt="Docker Compose Up Result"> 
                <p class="left m-0">
                    Er worden 2 containers gestart:
                    <ul>
                        <li><code>postgis</code>: een PostgreSQL database met PostGIS extensie</li>
                        <li><code>workspace</code>: een Ubuntu container met daarin alle benodigde tools geïnstalleerd</li>
                    </ul> 
                </p>

                <p class="left m-0">De twee containers draaien in een apart netwerk en kunnen met elkaar communiceren. De database is vanaf de host machine 
                    bereikbaar via poort <code>5439</code>, de workspace container is bereikbaar via poort <code>8080</code> (voor de webserver die we later gaan gebruiken).
                </p>

                <p class="alert notice"><b>Tip:</b> Gebruik het commando <code>docker compose down</code> om de containers
                    te stoppen en te verwijderen.</p>
            </section>

            <section>
                <h3>Docker containers</h3>
                 <div class="mermaid">
                %%{init: {'flowchart': {'htmlLabels': true}}}%%
graph TD
    subgraph my_network["Docker Network: my_network (bridge)"]
        A["PostGIS Container<br/>Image: postgis/postgis<br/>Ports: 5439→5432"]
        B["Workspace Container<br/>Build: ./Dockerfile (GDAL Alpine)<br/>Ports: 8080→8080"]
        A --- B
    end

    V["Volume: postgis_data<br/>Mount: /var/lib/postgresql/data"]
    V --- A

    subgraph Tools["Installed Tools in Workspace"]
        T1["GDAL (base image)"]
        T2["pg2b3dm"]
        T3["i3dm.export"]
        T4["3d-tiles-validator"]
        T5["http-server"]
        T6["PostgreSQL client (psql)"]
        B --> T1 & T2 & T3 & T4 & T5 & T6
    end

    classDef db fill:#FFD166,stroke:#333,stroke-width:2px,color:#000;
    classDef app fill:#06D6A0,stroke:#333,stroke-width:2px,color:#000;
    classDef vol fill:#118AB2,stroke:#333,stroke-width:2px,color:#fff;
    classDef tool fill:#073B4C,stroke:#333,stroke-width:1px,color:#fff;

    class A db;
    class B app;
    class V vol;
    class T1,T2,T3,T4,T5,T6 tool;
</div>
            </section>

            <!-- Verbinden met de database -->
            <section>
                <h3>QGIS connectie met database</h3>
                <div class="left">
                    <p>Gebruik username: <code>postgres</code> | password: <code>postgres</code></p>
                </div>
                <div style="display: flex; align-items: flex-start;">
                    <img src="images/qgis_new_connection.png" alt="QGIS Database new Connectie"  style="margin-right: 10px;" >
                    <img src="images/qgis_db_connection.png" alt="QGIS Database Connectie">
                </div>
            </section>

            <section>
                <h3>DBeaver connectie met database</h3>
                <div class="left">
                    <p>Gebruik username: <code>postgres</code> | password: <code>postgres</code></p>
                </div>
                <p class="left">Kies 'PostgreSQL' als database type.</p>

                <div style="display: flex; align-items: flex-start;">
                    <img src="images/dbeaver_new_connection.png" alt="QGIS Database new Connectie"  style="margin-right: 10px;" >
                    <img src="images/dbeaver_connection.png" alt="QGIS Database Connectie">
                </div>
            </section>

            <!-- Shell verbinding maken met de workspace container -->
            <section>
                <h3>Verbinding maken met workspace</h3>
                <div>
                    <ol>
                        <li>
                            <p>Gebruik het volgende commando om een shell verbinding te maken met de workspace
                                container:</p>
                            <pre><code class="language-bash">docker exec -it workspace bash</code></pre>
                        </li>
                        <img src="images/docker_workspace.png" alt="Docker Exec Result">
                        <li>
                            <p>Je komt nu in directory <code>/workspace</code> terecht. Deze map is via
                                een volume mapping direct verbonden met de <code>./container</code> map op je lokale
                                machine.</code> Alle bestanden die je in <code>./container</code> zet zijn ook
                                beschikbaar in <code>/workspace</code>, en andersom.</code></p>
                        </li>
                    </ol>
                    <p class="alert notice"><b>Tip:</b> Gebruik het commando <code>exit</code> of Ctrl + D om de
                        verbinding met de container te verbreken.</p>

                </div>
            </section>

            <!-- Deel 1: Dataverwerking - Introductie -->
            <section class="center">
                <h3>Deel 1: Dataverwerking tot 3D Tiles</h3>
                <div class="left">
                    <p>In dit deel gaan we:</p>
                    <ol>
                        <li>DTB data downloaden en importeren</li>
                        <li>Data voorbereiden in PostgreSQL</li>
                        <li>3D Tiles maken van DTB vlakken (b3dm)</li>
                        <li>3D Tiles maken van DTB punten (i3dm)</li>
                        <li>Tilesets valideren</li>
                    </ol>
                    <p>We gebruiken het Digitaal Topografisch Bestand (DTB) van Rijkswaterstaat als brondata.</p>
                    <p class="alert notice"><b>Tip:</b> Zie folder 'resultaten' voor al aangemaakte tilesets</p>
                </div>

            </section>

            <!-- Data downloaden en importeren -->
            <section>
                <h3>Data downloaden en importeren</h3>
                <div class="container">
                    <div class="col left">
                        <ol>
                            <li>Zoek via de <a
                                    href="https://geoweb.rijkswaterstaat.nl/ModuleViewer/?app=1c8c833022c04e63a0f74533c19a6a27"
                                    target="_blank">RWS DTB Bladindeling viewer</a> het Andijk kaartblad (DTB kaartblad
                                d15cz)</li>
                            <li>Download de data (d15cz.zip) en plaats de ZIP in <code>./container</code> folder.</li>
                            <li>Bekijk de inhoud met GDAL (vanuit je container shell):</li>
                        </ol>
                        <pre><code class="language-bash">ogrinfo /vsizip/d15cz.zip</code></pre>
                        <p>De zip bevat 3 shapefiles:</p>
                        <ul>
                            <li>d15cz_lin.shp (DTB lijnen)</li>
                            <li>d15cz_reg.shp (DTB vlakken)</li>
                            <li>d15cz_sym.shp (DTB punten)</li>
                        </ul>
                        <p class="alert notice"><b>Good to know:</b> de <code>/vsizip/</code> prefix voor de file path
                            in ogrinfo zorgt ervoor dat je ZIPs kunt inspecteren.</p>
                        <p class="alert notice">Vraag: wat is de projectie van de bestanden?</p>

                    </div>
                    <div class="col">
                        <img src="images/andijk.png" alt="Andijk">
                    </div>
                </div>
            </section>

            <!-- Data importeren in PostgreSQL -->
            <section>
                <h3>Data importeren in PostgreSQL</h3>
                <p>Nu gaan we de DTB data inladen in de database. Run de volgende commands vanuit de shell container.
                </p>
                <div class="container">
                    <div class="col left mr-3">
                        <p>Voor het laden van de DTB vlakken:</p>
                        <pre><code class="language-bash wrap">ogr2ogr -f "PostgreSQL" PG: /vsizip/d15cz.zip/d15cz_reg.shp -nln public.dtb_vlak_andijk -nlt MULTIPOLYGONZ</code></pre>
                        <p>Voor het laden van de DTB punten:</p>
                        <pre><code class="language-bash wrap">ogr2ogr -f "PostgreSQL" PG: /vsizip/d15cz.zip/d15cz_sym.shp -nln public.dtb_punt_andijk -nlt POINTZ</code></pre>
                    </div>
                    <div class="col">
                        <p>Controleer of de data goed geladen is:</p>
                        <pre><code class="language-bash wrap">psql -c "SELECT count(*) from public.dtb_vlak_andijk;"</code></pre>
                        <pre><code class="language-bash wrap">psql -c "SELECT count(*) from public.dtb_punt_andijk;"</code></pre>
                    </div>
                </div>
            </section>

            <!-- Data voorbereiden -->
            <section>
                <h3>Ruimtelijke indexen aanmaken</h3>
                <p>Maak ruimtelijke indexen aan in DBeaver:</p>
                <p>In DBeaver ga naar menu <code>SQL Editor</code> &gt; <code>New SQL Script</code></p>
                <img src="images/dbeaver_open_sql_script.png" alt="DBeaver New SQL Script">
                <pre><code class="language-sql">CREATE INDEX ON public.dtb_vlak_andijk USING gist(st_centroid(st_envelope(wkb_geometry)));
CREATE INDEX ON public.dtb_punt_andijk USING gist(wkb_geometry);</code></pre>
            </section>

            <section>
                <h3>Database view voor DTB punten</h3>
                <p>Maak een database view voor de punten (bomen) in DBeaver:</p>
                <pre><code class="language-sql">CREATE or replace view public.v_dtb_punt_andijk AS
SELECT
    RANDOM()*360 AS rotation,
    (RANDOM()*1.5)+0.5 AS scale,
    json_build_array(json_build_object('dtb id',dtb_id),
    json_build_object('omschrijving',omschr),
    json_build_object('datum',datum)) AS tags,
    'tree.glb' AS model,
    st_transform(wkb_geometry, 4979) AS geom
FROM public.dtb_punt_andijk
WHERE omschr = 'Boom';
                        </code></pre>
                <p class="alert notice"><b>Good to know:</b> we geven de bomen een random rotation en scale, zodat er
                    wat variatie in zit. Merk ook op dat we 'tree.glb' als string toevoegen, hiermee koppelen we later
                    het 3D model voor de boom.</p>
            </section>

            <!-- Data bekijken -->
            <section>
                <h3>Data bekijken</h3>
                <p>Gebruik QGIS om de data te bekijken.</p>
                <div class="container">
                    <div class="col mr-3">
                        <p>public.dtb_punt_andijk (bomen)</p>
                        <img src="images/qgis_trees.png" alt="DTB Punten in QGIS">
                    </div>
                    <div class="col">
                        <p>public.dtb_vlak_andijk</p>
                        <img src="images/qgis_vlakken.png" alt="DTB Vlakken in QGIS">
                    </div>
                </div>
            </section>

            <!-- 3D Tiles maken van DTB vlakken -->
            <section>
                <h3>3D Tiles maken van DTB vlakken</h3>
                <p>Maak 3D Tiles van de DTB vlakken.</p>
                <div class="container">
                    <div class="col mr-3">
                        <pre><code class="language-bash wrap">pg2b3dm -U postgres -h postgis -p 5432 -d postgres -t public.dtb_vlak_andijk -a dtb_id,omschr,datum --use_implicit_tiling false -o ./output/dtb_vlakken -c wkb_geometry --create_gltf false</code></pre>
                    </div>
                    <div class="col left">
                        <p class="small-text">Resultaat: een tileset.json bestand en een directory 'content' met de 3D
                            tiles in
                            b3dm formaat.</p>
                        <img src="images/output_pg2b3dm.png" alt="b3dm Tileset">
                    </div>
                </div>
            </section>

            <!-- 3D Tiles maken van DTB punten -->
            <section>
                <h3>3D Tiles maken van DTB punten</h3>
                <p>Maak 3D Tiles te maken van de DTB punten. We
                    kunnen op elk punt een 3D-model (bijvoorbeeld van een 3D boom model) tekenen.
                </p>
                <div class="container">
                    <div class="col left mr-3">
                        <pre><code class="language-bash wrap">i3dm.export -c "Host=postgis;Username=postgres;Password=postgres;Database=postgres;Port=5432" -t public.v_dtb_punt_andijk -o ./output/dtb_punten --use_i3dm true</code></pre>
                    </div>
                    <div class="col">
                        <p class="small-text">Resultaat: een tileset.json bestand, een directory 'content' met de 3D
                            tiles in i3dm formaat, en een subtree folder.</p>
                        <img src="images/tree_model.png" alt="Tree Model">
                    </div>
                </div>
            </section>

            <!-- Valideren tilesets -->
            <section>
                <h3>Tilesets valideren</h3>
                <div class="container">
                    <div class="col left mr-3">
                        <p>Valideer de tilesets met de <a
                                href="https://classic.yarnpkg.com/en/package/3d-tiles-validator">3d-tiles-validator</a>
                            (in de Docker container):</p>
                        <pre><code class="language-bash wrap">3d-tiles-validator --tilesetFile ./output/dtb_vlakken/tileset.json</code></pre>
                        <pre><code class="language-bash wrap">3d-tiles-validator --tilesetFile ./output/dtb_punten/tileset.json</code></pre>
                    <p class="alert notice"><b>Tip:</b>Bij valideren van dtb_punten verschijnen 'info' meldingen. Reden is dat model 'tree.glb' niet helemaal
                        voldoet aan de glTF specificatie. Voor nu negeren we deze waarschuwing.</b></p>
                     </p>
                    </div>
                </div>
            </section>

            <!-- Deel 2: Datavisualisatie - Introductie -->
            <section class="center">
                <h3>Deel 2: Datavisualisatie in 3D</h3>
                <p>In dit deel gaan we:</p>
                <ol>
                    <li>Een webserver opzetten</li>
                    <li>3D Tiles inladen in Cesium Viewer</li>
                    <li>Tileset stijlen aanpassen</li>
                    <li>3D modellen toevoegen</li>
                    <li>3D Basisvoorziening gebruiken</li>
                    <li>3D Tiles in QGIS inladen</li>
                </ol>
            </section>

            <!-- Server opzetten -->
            <section>
                <h3>Server opzetten</h3>

                <p>Er is een webserver geïnstalleerd in de docker container. De webserver serveert alle files uit de
                    <code>/workspace</code> folder. De server draait standaard op poort 8080.</p>
                <p>Start de server:</p>
                <pre><code class="language-bash">http-server</code></pre>

                <p>Open een webbrowser en ga naar <a href="http://localhost:8080"
                        target="_blank">http://localhost:8080</a></p>

                <p>Je ziet nu de directory structuur van <code>/workspace</code>.</p>
                <img src="images/http-server.png" alt="HTTP Server result">
            </section>

            <!-- Cesium Viewer -->
            <section>
                <h3>3D Tiles bekijken in een CesiumJS Viewer</h3>
                <p>We gaan nu de CesiumJS Viewer gebruiken om de 3D Tiles te bekijken.</p>
                <div class="container">
                    <div class="col left mr-3">
                        <p>Kopieer bestand <a href="cesium-viewer.html">cesium-viewer.html</a> uit de 3D Tiles workshop repository naar `./container`.
                            Deze HTML pagina bevat Javascript code die met behulp van de CesiumJS library 3D data
                            inlaadt.</p>
                        <p>In de code worden 4 tilesets geladen:</p>
                        <ul>
                            <li>PDOK achtergrondkaart (grijs)</li>
                            <li>PDOK quantized mesh terrein model</li>
                            <li>DTB Vlakken: ./output/dtb_vlakken/tileset.json</li>
                            <li>DTB punten: ./output/dtb_punten/tileset.json</li>
                        </ul>
                        <p>Open een browser en ga naar <a href="http://localhost:8080/cesium-viewer.html"
                                target="_blank">http://localhost:8080/cesium-viewer.html</a></p>
                    </div>
                    <div class="col">
                        <p>De Cesium viewer bevat een aantal kaartlagen:</p>
                        <ul>
                            <li>PDOK BRT achtergrondkaart</li>
                            <li>3D Basisvoorziening - Digitaal Terreinmodel (DTM)</li>
                        </ul>
                        <img src="images/cesium-viewer-open.png" alt="Cesium Viewer">
                    </div>
                </div>
            </section>

            <!-- Tileset stijlen aanpassen -->
            <section>
                <h3>Tileset stijlen aanpassen</h3>
                <p>Styling kan worden toegepast op twee manieren:</p>
                <ul>
                    <li>Tijdens het genereren van de tileset</li>
                    <li>Tijdens het visualiseren in de client</li>
                </ul>
                <p>Voeg de volgende code toe aan de tileset van de DTB vlakken voor het aanpassen van de style tijdens visualisatie:</p>
                <p class="alert notice"><b>Tip:</b> Voeg code toe onder regel '// todo: voeg hier code toe'</p>

                <pre><code class="language-javascript">tilesetDtbVlakken.style = new Cesium.Cesium3DTileStyle({
  color: {
    conditions: [
    ["${feature['osmchr']} === 'Bitumen'", "color('#430719')"],
    ["${feature['omschr']} === 'Steen bekleding'", "color('#740320')"],
    ["${feature['omschr']} === 'Bomen en struiken'", "color('#008000')"],
    ["${feature['omschr']} === 'Industrieterrein'", "color('#FFFF00')"]
    // todo: add more conditions
    ]
  }
});</code></pre>
                <p class="alert notice">Opdracht: maak features waar omschr === 'Meer' blauw (code #0000FF).</p>
            </section>

            <!-- 3D modellen toevoegen -->
            <section>
                <h3>3D modellen toevoegen</h3>
                <div class="container">
                    <div class="col left mr-3">
                        <p>Kopieer het 3D model <a href= "windturbine.glb">windturbine.glb</a> naar de werkdirectory.</p>
                        <p>Voeg de volgende code toe aan <code>cesium-viewer.html</code></p>
                        <pre><code class="language-javascript">const windturbine = viewer.entities.add({ 
  position: Cesium.Cartesian3.fromDegrees(5.193486,52.754867), 
  model: { 
    uri: "windturbine.glb"         
  }, 
});</code></pre>
                    </div>
                    <div class="col">
                        <img src="images/windturbine.png" alt="Windturbine">
                        <img src="images/windturbine.gif" alt="Windturbine Animated">
                    </div>
                </div>
            </section>

            <!-- 3D Basisvoorziening -->
            <section>
                <h3>3D Basisvoorziening</h3>
                <p>In de 3D Basis voorziening van PDOK zijn landelijke 3D Tilesets beschikbaar.</p>
                <p>Voeg de 3D gebouwen tileset toe aan de Cesium Viewer:</p>
                <pre><code class="language-javascript">const tileset3DGebouwen = await Cesium.Cesium3DTileset.fromUrl(
  "https://api.pdok.nl/kadaster/3d-basisvoorziening/ogc/v1_0/collections/gebouwen/3dtiles"
);  
viewer.scene.primitives.add(tileset3DGebouwen);</code></pre>

            <p class="alert notice"><b>Tip:</b> Voor 3D LoD2.2 gebouwen gebruik https://data.3dbag.nl/v20250903/cesium3dtiles/lod22/tileset.json</p>

            </section>

            <!-- Optionele opdracht: maak 3D Tiles van panden in Andijk -->
            <section class="center">
                <h3>Maak 3D Tiles van panden in Andijk</h3>
                <p>Ga naar site <a href="https://3dbag.nl/en/download">https://3dbag.nl/en/download</a> en klik op knop 'Pick a tile'.
                    Selecteer het kaartblad waar Andijk in ligt (kaartblad 8-512-888) en download de BAG data (GeoPackage formaat).</p>
                <p>Volg dezelfde stappen als bij DTB vlakken om 3D Tiles te genereren:</p>
                
                <p>Stappen:</p>
                <ol>
                    <li>Kopieer bestand 8-512-888.gpkg naar de container folder</li>
                    <li>Importeer de data in PostgreSQL</li>
                    <li>Maak 3D Tiles van de panden</li>
                    <li>Voeg de tileset toe aan de Cesium Viewer</li>
                </ol>
                <p class="alert notice"><b>Tip:</b> De volgende slide bevat de uitwerkingen van deze stappen.</p>
            </section>

            <section>
                <h3>Uitwerking 3D Tiles van panden in Andijk maken</h3>

                <p class="left">1. Laden van de BAG data in PostgreSQL:</p>
                <pre><code class="language-bash wrap">ogr2ogr -f "PostgreSQL" PG: 8-512-888.gpkg lod22_3d -nln public.bag3d -nlt MULTIPOLYGONZ</code></pre>
                <p class="left">2. Aanmaken ruimtelijke index in DBeaver:</p>
                <pre><code class="language-sql">CREATE INDEX ON public.bag3d USING gist(st_centroid(st_envelope(geom)));</code></pre>
                <p class="left">3. 3D Tiles genereren:</p>
                <pre><code class="language-bash wrap">pg2b3dm -U postgres -h postgis -p 5432 -d postgres -t public.bag3d -a labels --use_implicit_tiling false -o ./output/bag3d -c geom --create_gltf false</code></pre>
                <p class="left">4. Toevoegen aan Cesium Viewer:</p>
                <pre><code class="language-javascript">
                const tilesetBag3dVlakken = await Cesium.Cesium3DTileset.fromUrl("./output/bag3d/tileset.json");
                viewer.scene.primitives.add(tilesetBag3dVlakken);
                </code></pre>

            </section>

            <!-- Optionele opdracht 2: voeg IFC model toe -->
            <section class="center">
                <h3>Conversie IFC naar GLB</h3>
                <p class="left m-0">Ga naar site <a href = "https://3dviewer.net/#model=https://geonovum.github.io/temp_geobim/data/Kievitsweg_R25_ILS%20Spaces%2020250815_LoGeoRef.ifc">https://3dviewer.net/#model=https://geonovum.github.io/temp_geobim/data/Kievitsweg_R25_ILS%20Spaces%2020250815_LoGeoRef.ifc</a>
                en klik op know 'Export'. Kies export naar GLB.
                <img src="images/3dviewer_export.png" alt="IFC to GLB conversion">
                </p>
            </section>
            <section>
                <h3>Voeg IFC model toe</h3>
                <p class="left m-0">Plaats model.glb in container folder</p>
                <p class="left m-0">Voeg toe aan Cesium Viewer:</p>
                <pre><code class="language-javascript">
                viewer.entities.add({ 
                    position: Cesium.Cartesian3.fromDegrees(5.194139,52.753524), 
                    model: { 
                    uri: "model.glb",
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND         
                    }, 
                });
                </code></pre>
                <p class="alert notice"><b>Tip:</b> Gebruik HeightReference.CLAMP_TO_GROUND om het model op het terrein te plaatsen.</p>
                <p class="alert notice"><b>Tip:</b> Het IFC model wordt geplaatst in de buurt van de windturbine</p>
                <p class="alert notice"><b>Tip:</b> Element 'IfcSite' in de IFC file kan worden gebruikt om de juiste locatie van het model te definiëren.</p>
                <p class="alert notice"><b>Vraag:</b> Wat zijn de beperkingen van deze aanpak?</p>
            </section>

            <!-- QGIS 3D Tiles -->
            <section>
                <h3>QGIS 3D Tiles</h3>
                <div class="two-columns">
                    <div>
                        <ol>
                            <li>Open QGIS en ga naar 'Layer' -> 'Data Source Manager' -> 'Scene'</li>
                            <li>Zet 'Source Type' op 'Service'</li>
                            <li>Maak een nieuwe connectie aan via 'New' -> 'New Cesium 3D Tiles Connection'</li>
                            <li>Name: panden</li>
                            <li>URL: http://localhost:8080/output/andijk_panden/tileset.json</li>
                        </ol>
                    </div>
                    <div>
                        <img src="images/qgis_tiled_scene_connection.png" alt="QGIS Tiled Scene Connection">
                    </div>
                </div>
            </section>

            <!-- QGIS 3D Tiles visualisatie -->
            <section>
                <h3>QGIS 3D Tiles visualisatie</h3>
                <div class="two-columns">
                    <div>
                        <p>2D weergave in QGIS:</p>
                        <img src="images/qgis_3dtiles_2d.png" alt="QGIS 3D Tiles 2D">
                        <p class="small-text">Vraag: Waarom bestaan alle panden uit driehoeken?</p>
                    </div>
                </div>
            </section>

            <section>
                <h3>QGIS 3D Tiles visualisatie</h3>
                <div class="two-columns">
                    <div>
                        <p>3D weergave in QGIS (via Views -> 3D Map Views -> Create new 3D Map View)</p>
                        <img src="images/qgis_3dtiles_panden.png" alt="QGIS 3D Tiles Panden">
                        <p class="small-text">Wat valt er op aan de 3D View in QGIS?</p>
                    </div>
                </div>
            </section>

            <!-- Cleanup na de workshop -->
            <section>
                <h3>Cleanup na de workshop</h3>
                <p>Voer de volgende commando's uit om de Docker containers te stoppen en te verwijderen:</p>
                <pre><code class="language-bash">docker compose down</code></pre>
                <!-- Delete dangling docker images -->
                <p>Verwijder docker images:</p>
                <pre><code class="language-bash">docker rmi 3dtiles_workshop-workspace</code></pre>
                <pre><code class="language-bash">docker rmi postgis/postgis</code></pre>
                <p>Verwijder database data:</p>
                <pre><code class="language-bash">docker volume rm 3dtiles_workshop_postgis_data</code></pre>
            </section>

            <!-- Afsluiting -->
            <section class="center">
                <h3>Afsluiting</h3>
                <p><b>Wat hebben we geleerd?</b>
                <ul>
                    <li>Kennis van de 3D Tiles-standaard</li>
                    <li>Inzicht in de software en technieken voor het maken van 3D-tilesets</li>
                    <li>Een 3D-tileset laden in een webomgeving en in QGIS</li>
                    <li>Mogelijkheden voor datavisualisatie met CesiumJS</li>
                </ul>
                </p>
            </section>

            <!-- Bronnen en links -->
            <section class="center">
                <h3>Bronnen en links</h3>
                <ul class="small-text">
                    <li><a href="https://github.com/CesiumGS/3d-tiles" target="_blank">3D Tiles specificatie</a></li>
                    <li><a href="https://github.com/CesiumGS/3d-tiles/blob/main/3d-tiles-reference-card.pdf"
                            target="_blank">3D Tiles Reference Card</a></li>
                    <li><a href="https://github.com/Geodan/pg2b3dm" target="_blank">pg2b3dm</a> - Tool voor het maken
                        van b3dm tilesets</li>
                    <li><a href="https://github.com/Geodan/i3dm.export" target="_blank">i3dm.export</a> - Tool voor het
                        maken van i3dm tilesets</li>
                    <li><a href="https://github.com/CesiumGS/3d-tiles-validator" target="_blank">3D Tiles Validator</a>
                    </li>
                    <li><a href="https://cesium.com/platform/cesiumjs/" target="_blank">CesiumJS</a></li>
                    <li><a href="https://api.pdok.nl/kadaster/3d-basisvoorziening/ogc/v1_0/collections"
                            target="_blank">PDOK 3D Basisvoorziening</a></li>
                </ul>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/plugin/notes/notes.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/plugin/markdown/markdown.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/plugin/highlight/highlight.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="plugins/copycode/copycode.js"></script>
    <script>
        Reveal.initialize({
            center: false,
            hash: true,
            slideNumber: 'c/t',
            copycode: {
                style: {
                    copybg: "#347CAE",
                    scale: 0.6,
                },
            },
            plugins: [RevealMarkdown, RevealHighlight, RevealNotes, CopyCode]
        });
        mermaid.initialize({ startOnLoad:true });
    </script>
</body>

</html>
